# –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã 3 —Å–ø—Ä–∏–Ω—Ç–∞

## [Task 1](https://github.com/dimk00z/Admin_panel_sprint_2/blob/main/tasks/01_django.md)

–î–æ–±–∞–≤–ª–µ–Ω–∞ [–ø–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è api](https://github.com/dimk00z/Admin_panel_sprint_2/tree/main/movies_admin/api/v1), –≤ –∫–æ—Ç–æ—Ä–æ–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—ã–≥—Ä—É–∑–∫–∞ json –≤ —Ñ–æ—Ä–º–∞—Ç–µ [django_openapi.yml](https://github.com/dimk00z/Admin_panel_sprint_2/blob/main/files/django_openapi.yml).
–í—Å—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–ø–∏—Å–∞–Ω–∞ –≤ [views.py](https://github.com/dimk00z/Admin_panel_sprint_2/blob/main/movies_admin/api/v1/views.py).
Queryset —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ —Ñ–∏–ª—å–º–∞–º —Å prefetch_related –ø–æ "persons", "film_genres". –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –∂–∞–Ω—Ä–∞–º –∏ —Ä–æ–ª—è–º –ø–µ—Ä—Å–æ–Ω.

## [Task 2](https://github.com/dimk00z/Admin_panel_sprint_2/blob/main/tasks/02_docker.md), [Task 3](https://github.com/dimk00z/Admin_panel_sprint_2/blob/main/tasks/03_nginx.md)

–î–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è docker-compose.

–§–∞–π–ª [docker-compose.yaml](https://github.com/dimk00z/Admin_panel_sprint_2/blob/main/docker-compose.yaml) —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–ø–∏—Å–∞–Ω–∏–µ —Ç—Ä–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞:

1. `postges_movie_db` - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è postgres. –í —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ñ–∞–π–ª—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–≤—è–∑–∞–Ω—ã —Å –ø—É—Ç–µ–º `../postgres`

2. `movies_admin` - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –±—ç–∫—ç–Ω–¥–æ–º django –Ω–∞ –æ—Å–Ω–æ–≤–µ [Dockerfile_django](https://github.com/dimk00z/Admin_panel_sprint_2/blob/main/Dockerfile_django). –ü—Ä–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏ –≤ –æ–±—Ä–∞–∑ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ [production.txt](https://github.com/dimk00z/Admin_panel_sprint_2/blob/main/movies_admin/requirements/production.txt). –°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ `gunicorn`.
3. `nginx` - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å nginx –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ [Dockerfile_nginx](https://github.com/dimk00z/Admin_panel_sprint_2/blob/main/nginx/Dockerfile_nginx) –¥–ª—è –æ—Ç–¥–∞—á–∏ —Å—Ç–∞—Ç–∏–∫–∏ –∏ –ø—Ä–æ–±—Ä–æ—Å–∞ —Å movies_admin:8000.

## –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

1. –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤ movies_admin –Ω–µ–æ–±—Ö–æ–¥–∏–º `.env` —Ñ–∞–π–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ [.env_example](https://github.com/dimk00z/Admin_panel_sprint_2/blob/main/movies_admin/.env_example).
2. `docker-compose up -d --build` - –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –ø–µ—Ä–≤–∏—á–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ–¥–µ–Ω—ã –∏ –≤ –±–∞–∑–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
3. –ü—Ä–∏–º–µ—Ä —Å—Å—ã–ª–æ–∫:

http://localhost/admin/

http://localhost/api/v1/movies/

http://localhost/api/v1/movies/00af52ec-9345-4d66-adbe-50eb917f463a/

4. `docker-compose down -v`

___


# –ü—Ä–æ–µ–∫—Ç–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ: ETL

–í –ø—Ä–µ–¥—ã–¥—É—â–µ–º –º–æ–¥—É–ª–µ –≤—ã —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞–ª–∏ –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞. –¢–µ–ø–µ—Ä—å —É–ª—É—á—à–∏–º –µ–≥–æ: –Ω–∞—É—á–∏–º –µ–≥–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–æ–≤–æ–π —Å—Ö–µ–º–æ–π –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

## –ü–æ–¥—Å–∫–∞–∑–∫–∏

–ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –≤—ã –ø—Ä–∏—Å—Ç—É–ø–∏—Ç–µ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –∑–∞–¥–∞–Ω–∏—è, –¥–∞–¥–∏–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥—Å–∫–∞–∑–æ–∫:

1. –ü—Ä–µ–∂–¥–µ —á–µ–º –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–¥–∞–Ω–∏–µ, –ø–æ–¥—É–º–∞–π—Ç–µ, —Å–∫–æ–ª—å–∫–æ ETL-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –≤–∞–º –Ω—É–∂–Ω–æ.
2. –î–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥–∞ —Å–æ–≤–µ—Ç—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å pydantic.
3. –î–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è ETL-–ø—Ä–æ—Ü–µ—Å—Å–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ—Ä—É—Ç–∏–Ω—ã.
4. –ß—Ç–æ–±—ã —Å–ø–æ–∫–æ–π–Ω–æ –ø–µ—Ä–µ–∂–∏–≤–∞—Ç—å –ø–∞–¥–µ–Ω–∏—è Postgres –∏–ª–∏ Elasticsearch, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ—à–µ–Ω–∏–µ —Å —Ç–µ—Ö–Ω–∏–∫–æ–π `backoff` –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω–æ–∏–º—ë–Ω–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É.
5. –í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —É–º–µ—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –Ω–∞—á–∏–Ω–∞—Ç—å —á–∏—Ç–∞—Ç—å —Å —Ç–æ–≥–æ –º–µ—Å—Ç–∞, –≥–¥–µ –æ–Ω–æ –∑–∞–∫–æ–Ω—á–∏–ª–æ —Å–≤–æ—é —Ä–∞–±–æ—Ç—É.
6. –ü—Ä–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–∏ ETL-–ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–æ–¥—É–º–∞–π—Ç–µ, –∫–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω—É–∂–Ω—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –°—Ç–∞—Ä–∞–π—Ç–µ—Å—å –æ—Å—Ç–∞–≤–ª—è—Ç—å –≤ –∫–æ–¥–µ –∫–∞–∫ –º–æ–∂–Ω–æ –º–µ–Ω—å—à–µ ¬´–º–∞–≥–∏—á–µ—Å–∫–∏—Ö¬ª –∑–Ω–∞—á–µ–Ω–∏–π.
7. –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –ë–î –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –æ–±–æ–±—â—ë–Ω–Ω—ã–º, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–∏—à–ª–æ—Å—å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥. –ü—Ä–∏ –æ–±–æ–±—â–µ–Ω–∏–∏ –Ω–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –æ —Ç–æ–º, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö –¥–æ–ª–∂–Ω—ã —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è.
8. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–∞–π–ø–∏–Ω–≥–æ–≤ –ø–æ–º–æ–∂–µ—Ç —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –¥–µ–±–∞–≥–∞ –∏ –ø–æ–≤—ã—Å–∏—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∫–æ–¥–∞ —Ä–µ–≤—å—é–µ—Ä–∞–º–∏, –∞ –∑–Ω–∞—á–∏—Ç —Ä–∞–±–æ—Ç—ã –±—É–¥—É—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è –±—ã—Å—Ç—Ä–µ–µ :)
9. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–∏—à–∏—Ç–µ, —á—Ç–æ –¥–µ–ª–∞—é—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –∫–æ–¥–µ.
10. –î–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–¥—É–ª—å `logging` –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Python.

–ñ–µ–ª–∞–µ–º –≤–∞–º —É–¥–∞—á–∏ –≤ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ ETL! –í—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–ø—Ä–∞–≤–∏—Ç–µ—Å—å üí™ 

**–†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∑–∞–ª–µ–π—Ç–µ –≤ –ø–∞–ø–∫—É `postgres_to_es` –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.**


